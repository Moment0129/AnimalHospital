<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vet.main.attendance.AttendanceDAO">

	<sql id="forPager">
		<choose>
			<when test="kind=='apTitle'">
				EMPNAME
			</when>
			<when test="kind=='apContents'">
				POSITIONNAME
			</when>
			<when test="kind=='apContents'">
				DEPTNAME
			</when>
			<otherwise>
				ATTSTATE
			</otherwise>
		</choose>
	</sql>

	<insert id="setAttIn" parameterType="AttendanceVO">
		INSERT INTO ATTENDANCE
		(ATTNO, USERNAME, TODAY, ATTIN, ATTSTATE)
		VALUES
		(NULL, #{username}, DATE_FORMAT(NOW(), '%Y-%m-%d'), #{attIn}, 1)
	</insert>
	
	<update id="setAttOut" parameterType="AttendanceVO">
		UPDATE ATTENDANCE
		SET
		ATTOUT = #{attOut}
		WHERE
		ATTNO = #{attNo}
		AND TODAY = DATE_FORMAT(NOW(), '%Y-%m-%d')
	</update>
	
	<select id="getAttList" parameterType="AttendanceVO" resultType="AttendanceVO">
		<![CDATA[
		SELECT A.*, E.EMPNAME, P.POSITIONNAME, D.DEPTNAME
		FROM ATTENDANCE A RIGHT OUTER JOIN EMP E
		ON A.USERNAME = E.USERNAME
		INNER JOIN POSITION P
		ON E.POSITIONNO = P.POSITIONNO
		INNER JOIN DEPARTMENT D
		ON E.DEPTNO = D.DEPTNO
		ORDER BY (
			CASE WHEN ASCII(SUBSTRING(E.EMPNAME,1)) < 123 THEN 2 ELSE 1 END
		    	), E.EMPNAME;
		]]>
	</select>

</mapper>