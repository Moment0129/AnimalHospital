<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vet.main.dept.DeptDAO">

<select id="getEmpList" parameterType="com.vet.main.dept.DeptVO" resultMap="getDetailResult">
	SELECT * 
	FROM EMP E INNER JOIN DEPARTMENT D
	ON E.DEPTNO = D.DEPTNO
	INNER JOIN POSITION P
	ON E.POSITIONNO = P.POSITIONNO
	WHERE E.DEPTNO != 0
</select>

<select id="deptList" parameterType="com.vet.main.dept.DeptVO">

	WITH RECURSIVE DEPTLIST AS (
    SELECT DEPTNO, DEPTNAME, PARENTNO, DEPTH
    FROM DEPARTMENT
    WHERE PARENTNO IS NULL

    UNION ALL

    SELECT d.DEPTNO, d.DEPTNAME, d.PARENTNO, dh.DEPTH + 1
    FROM DEPARTMENT d
    INNER JOIN DEPTLIST dh ON d.PARENTNO = dh.DEPTNO
	)
	SELECT * FROM DEPTLIST WHERE DEPTNO!=999 ORDER BY DEPTNO ASC

</select>

<resultMap type="com.vet.main.dept.DeptVO" id="getDetailResult">
		<id column="USERNAME" property="username"/>
		<result column="EMPNO" property="empNo"/>
		<result column="PASSWORD" property="password"/>
		<result column="NAME" property="name"/>
		<result column="EMAIL" property="email"/>
		<result column="PHONE" property="phone"/>
		<result column="HIREDATE" property="hireDate"/>
		<result column="STATE" property="state"/>
		<result column="POSITIONNO" property="positionNo"/>
		<result column="DEPTNO" property="deptNo"/>
		<result column="BIRTH" property="birth"/>
	</resultMap>


</mapper>