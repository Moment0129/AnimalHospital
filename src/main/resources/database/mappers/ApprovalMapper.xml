<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vet.main.approval.ApprovalDAO">
	<insert id="setApPoomAdd" parameterType="ApprovalVO">
		INSERT INTO APPROVAL
		(APNO, EMPNO, APFORMATNO, APTITLE, APCDATE, APCONTENTS, APSTATE, APREJECTION, APKIND)
		VALUES
		(NULL, #{empNo}, 11, #{apTitle}, NOW(), #{apContents}, '결재대기중', '', '품의서')
	</insert>
  	
  	<select id="getApUser" parameterType="com.vet.main.emp.EmpVO" resultMap="getUserResult">
  		SELECT E.*, P.*, D.* 
		FROM EMP E INNER JOIN POSITION P 
		ON E.POSITIONNO=P.POSITIONNO 
		INNER JOIN DEPARTMENT D 
		ON E.DEPTNO=D.DEPTNO
		WHERE E.EMPNO=#{empNo}
  	</select>
  	
	<resultMap type="com.vet.main.emp.EmpVO" id="getUserResult">
		<id column="EMPNO" property="empNo"/>
		<result column="PASSWORD" property="password"/>
		<result column="NAME" property="name"/>
		<result column="EMAIL" property="email"/>
		<result column="PHONE" property="phone"/>
		<result column="ADDRESS" property="address"/>
		<result column="HIREDATE" property="hireDate"/>
		<result column="RANDOMPW" property="randomPw"/>
		<result column="FILENAME" property="fileName"/>
		<result column="ORIGINALFILENAME" property="originalFileName"/>
		<result column="STATE" property="state"/>
		<result column="POSITIONNO" property="positionNo"/>
		<result column="DEPTNO" property="deptNo"/>
	</resultMap>
	
	
	<!-- 기안함 -->
	<select id="getDraftList" parameterType="com.vet.main.emp.EmpVO" resultType="ApprovalVO">
		SELECT A.*, E.NAME, D.DEPTNAME
			FROM APPROVAL A INNER JOIN EMP E
			ON A.EMPNO = E.EMPNO
			INNER JOIN DEPARTMENT D
			ON E.DEPTNO = D.DEPTNO
		WHERE E.EMPNO = #{empNo}
		ORDER BY A.APNO DESC;
	</select>
	


</mapper>